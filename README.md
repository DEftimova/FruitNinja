# FruitNinja
Proekt Vizuelno Programiranje

1. Опис на апликацијата
Играта  која ја развиваме претставува верзија на популарната мобилна апликација  Fruit Ninja. Оваа верзија на играта на корисникот му нуди стандарден gameplay mode кој подлегнува на класичните правила на оригиналната игра, како и опција за зачувување на најдобрите резултати, нивен преглед и информации за правилата на игра.
Дизајнот на нашата апликација визуелно се темели на оригиналот, додека најзначајната разлика во имплементацијата е постоењето на нивоа на тежина на играта. Имено, нашата Fruit Ninja има неколку нивоа на тежина кои се менуваат заедно со поените на играчот.

2. Опции

2.1. New game
На почетното мени на апликацијата понудени се неколку опции меѓу кои и New Game (слика 1)
![alt tag](https://github.com/DEftimova/FruitNinja/blob/master/StartMenu.png) 
Со клик на ова копче се прикажува валидациски регулирана Text Box контрола во која играчот треба да го впише своето корисничко име.
![alt tag](https://github.com/DEftimova/FruitNinja/blob/master/Continue.png) 
Со клик на копчето Continue се валидира корисничкото име и истото, доколку е валидно, се пребарува низ базата на корисници. Доколку играчот првпат ја игра играта, неговото корисничко име се зачувува во базата, инаку се обновува неговиот најдобар резултат доколку истиот е надминат на крајот од играта. 

2.2. Highscores
Со клик на копчето Highscores на почетното мени се испишуваат имињата и бодовите на најдобрите пет играчи. Овие информации се обновуваат по секоја нова игра, во случај тековниот играч да се пласирал меѓу најдобрите 5.

2.3. How to play
Оваа опција на корисникот му ги нуди основните информации за правилата на игра:
•	Целта на играта е да се пресечат што повеќе овошја
•	Секое испуштено овошје ги намалува поените на играчот
•	Играта завршува кога корисникот ќе пресече бомба

2.4. About
Нуди информации за развивачите на играта.

2.5. Quit
Се наоѓа во GameOver формата, служи за терминирање на апликацијата.

3. Имплементација
Играта претставува апликација изработена во Windows Forms со помош на програмскиот јазик C#. Таа е составена од три форми - StartMenu, play и GameOver, и една класа за играч - Player.

3.1. StartMenu
Оваа форма се прикажува прва кога се стартува апликацијата. Функционалностите кои ги обезбедува се опишани во точка 2. Опции од оваа документација.
Во конструкторот на оваа форма, по повикувањето на методата InitializeComponent() се повикува методата GenerateHighscores() која ја обновува листата на најдобрите играчи т.ш. истата соодветствува со резултатите добиени по последната игра. Потоа се подесува soundtrack-от на играта со помош на SoundPlayer функцијата од библиотеката System.Media.
Во остатокот од кодот се специфицираат функционалностите на следните методи:
•	private void btnPlay_Click(object sender, EventArgs e) - Се повикува со клик на копчето New Game. Во оваа метода TextBox контролата за внесување на корисничко име и копчето Continue се поставуваат на visible. Фокусот се поставува на tbUsername.
•	private void btnContinue_Click(object sender, EventArgs e) - Се повикува со клик на копчето Continue, откако успешно ќе биде внесено корисничко име. Во оваа функција се инстанцира објект од типот FruitNinja (опишан во play.cs) и истиот се прикажува на екран.
•	private void tbUserName_Validating(object sender, CancelEventArgs e) - Служи за валидација на корисничкото име.
•	private void btnHighScores_Click(object sender, EventArgs e) -  Се повикува со клик на копчето Continue. Во рамките на оваа функција се повикува ShowHighScores().
•	private void btnHowToPlay_Click(object sender, EventArgs e) - Прикажува информации за правилата на игра.
•	private void btnAbout_Click(object sender, EventArgs e) - Прикажува информации за апликацијата.
•	private void GenerateHighScores() - Служи за инизијализирање на листата на петте најдобри играчи. Доколку фајлот во кој истите се запишани е непостоечки, истиот се креира по што во него се запишува иницијалната листа на најдобри играчи.
•	private void ShowHighScores() - Служи за испишување на најдобрите резултати на екран.

3.2. play
![alt tag](https://github.com/DEftimova/FruitNinja/blob/master/play.png) 
Во оваа форма се одвива играта. Истата се прикажува по успешното логирање на корисникот. Во конструкторот на формата се подесува звукот кој се слуша при сечење на овошјето, како и курсорот (.ico фајл кој може да се најде во Resources фолдерот). 
Формата содржи дефиниции на неколку методи потребни за играта, меѓу кои:
•	public void play_Load(object sender, EventArgs e) - Служи за генерирање на координатите на следното овошје (или бомба) која ќе се појави на екранот. Потоа се стартува тајмерот timer1 кој служи за исцртување на генерираното овошје.
•	private void timer1_Tick(object sender, EventArgs e) - Функцијата која се повикува по стартувањето на timer1 и која ги обновува координатите на овошјето во секое отчукување. Во рамките на оваа метода, кога овошјето ќе достигне одредена висина на екранот, се стартува timer2.
•	private void timer2_Tick(object sender, EventArgs e) - Додека со timer1 се регулираше "искачувањето" на овошјето по екранот, со оваа метода, по истиот принцип, се исцртува "спуштањето" до дното на екранот.
•	private void pictureBoxN_MouseEnter(object sender, EventArgs e) - Во зависност од N (1 <= N <= 6), се повикува една од N-те методи во кои се пушта звукот на сечење овошје и сликата од N-тото овошје се заменува со две слики од половинки од овошјето кои потоа паѓаат по екранот. За N=6 се повикува функцијата соодветна на сечење на бомба, во која се инстанцира нов објект од типот GameOver на кој се предава контролата и играта завршува.
•	private void FruitNinja_FormClosing(object sender, FormClosingEventArgs e) - Се повикува при клик на X во горниот десен агол на формата. Со повик на Application.Exit() формата целосно се исклучува.

3.3. GameOver
![alt tag](https://github.com/DEftimova/FruitNinja/blob/master/GameOver.png) 
По инстанцирањето на објект од оваа класа во play формата, истиот се користи за да се прикаже формата GameOver. Како и во претходните две форми, во конструкторот се подесува музиката, но покрај тоа се повикува и GenerateHighscores() со цел да се обноват податоците за најдобрите играчи по завршетокот на играта.
Во рамките на GameOver.cs се вклучени дефиниции на следните функции:
•	private void btnQuit_Click(object sender, FormClosingEventArgs e) - Се повикува при клик на копчето Quit, по што на корисникот му се прикажува MessageBox во кој може да избере дали сака да се врати на менито или да ја исклучи играта.
•	private void FruitNinja_FormClosing(object sender, FormClosingEventArgs e) -  Запира soundtrackot и формата се исклучува.
•	private void btnHighscores_Click(object sender, EventArgs e) - Се повикува при клик на копчето Highscores. Во телото на функцијата се повикува ShowHighScores().
•	private void GenerateHighScores() и private void ShowHighScores() - Опишани во 3.1. StartMenu.
•	public void saveHighScore() - Служи за вметнување на поените на моменталниот играч во базата на играчи. Доколку играчот е пронајден, се проверува дали го надминал досегашниот рекорд и ако го надминал, истиот се обновува. Доколку играчот не е пронајден, истиот се додава во базата.

3.4. Player
Со цел податоците за играчите да бидат достапни и по терминацијата на играта, класата во која тие информации се чуваат е [Serializable].
Понатаму, кога овие податоци ќе бидат потребни за генерирање на листата на играчи, истите се добиваат со помош на Deserialize(stream) методот применет над инстанца од BinaryFormatter.
  Stream stream = File.OpenRead("HighScores.bin");
  BinaryFormatter bf = new BinaryFormatter();
  List<Player> list = (List<Player>)bf.Deserialize(stream);
По десеријализацијата и измената на податоците, истите повторно се впишуваат во датотеката Highscore.bin.
  stream.Close();
  File.Create("HighScores.bin").Dispose();
  stream = File.Create("HighScores.bin");
  bf = new BinaryFormatter();
  bf.Context = new StreamingContext(StreamingContextStates.CrossAppDomain);
  bf.Serialize(stream, list);
  stream.Flush();
  stream.Close();
